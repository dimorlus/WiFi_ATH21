cmake_minimum_required(VERSION 3.16)
project(mqtt_logger)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Настройка для vcpkg
if(DEFINED ENV{VCPKG_ROOT} AND NOT DEFINED CMAKE_TOOLCHAIN_FILE)
    set(CMAKE_TOOLCHAIN_FILE "$ENV{VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake"
        CACHE STRING "")
endif()

# Найти пакеты
find_package(PkgConfig REQUIRED)
find_package(paho-mqttpp3 REQUIRED)
find_package(paho-mqtt3as REQUIRED)

# Включить заголовочные файлы
include_directories(src)

# Исходные файлы
set(SOURCES
    src/main.cpp
    src/config.cpp
    src/logger.cpp
)

# Создать исполняемый файл
add_executable(mqtt_logger ${SOURCES})

# Связать библиотеки
target_link_libraries(mqtt_logger 
    paho-mqttpp3
    paho-mqtt3as
)

# Для Windows добавить дополнительные библиотеки
if(WIN32)
    target_link_libraries(mqtt_logger ws2_32 crypt32 secur32)
endif()

# Установка
install(TARGETS mqtt_logger DESTINATION bin)